\documentclass[pagesize=false,frenchb]{scrartcl}
% \usepackage[margin=1in]{geometry}

\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}

% Put some french in it
\usepackage{polyglossia}

\newcommand{\pref}[1]{\ref{#1} à la page~\pageref{#1}}

\usepackage[toc,page]{appendix}

% And hypertext links everywhere
\usepackage{hyperref}

% To get a proper text encoding with xelatex
\usepackage{fontspec}
\setmainfont{Crimson-Roman.otf}[
  Path =./fonts/,
  BoldFont = Crimson-Bold.otf,
  ItalicFont = Crimson-Italic.otf,
  BoldItalicFont = Crimson-BoldItalic.otf
]

% Render inference rules
\usepackage{mathpartir}
% The labels of those rules
\newcommand{\irlabel}[1]{\text{\emph{(#1)}}}

% Some math caracters (\{ll,rr}bracket in particular)
\usepackage{stmaryrd}
\usepackage{amsmath}

% Fore code blocks
\usepackage{listings}
\definecolor{lstbg}{rgb}{0, 0, 0.3}
\lstdefinelanguage{NLight}{%
  morekeywords={let,in,if,then,else,Cons,Nil},
  morekeywords={[2]Int,true,false,Bool,T, Empty, Any},   % types go here
  otherkeywords={:,;,=,[,],\{,\},...}, % operators go here
  literate={% replace strings with symbols
    {->}{{$\to$}}{1}
    {lambda}{{$\lambda$}}{1}
    {tau}{{\ensuremath{\tau}}}{1}
    {rho}{{\ensuremath{\rho}}}{1}
    {tin}{{$\in$}}{1}
    {\&}{{$\wedge$}}{1}
    {LB}{{\{}}{1}
    {RB}{{\}}}{1}
    {DOLLAR}{{\$}}{1}
    {(|}{{\ensuremath{\llbracket}}}{1} % chktex 9
    {|)}{{\ensuremath{\rrbracket}}}{1} % chktex 9
    {(||}{{\ensuremath{\llparenthesis}}}{1} % chktex 9
    {||)}{{\ensuremath{\rrparenthesis}}}{1} % chktex 9
  },
  basicstyle={\sffamily},
  keywordstyle={\bfseries},
  keywordstyle={[2]\itshape}, % style for types
  keepspaces,
  mathescape % optional
}[keywords,comments,strings]
\lstset{%
  escapeinside={//*}{*//},
  breaklines=true,
  mathescape=true,
  language=NLight,
  basicstyle=\color{lstbg}
}

\lstMakeShortInline{°}

\usepackage{myunicode}

\usepackage[
  fencedCode,
  hybrid,
  html,
  inlineFootnotes
  ]{markdown}

\newcommand{\τ}{\ensuremath{\tau}}
\catcode`τ=13
\catcode`λ=13
\newcommand{λ}{\ensuremath{\lambda}}

\title{Rapport de stage}
\subtitle{Un système de types pour Nix}
\author{Théophane Hufschmitt}
\date{21 Août 2017}

\markdownSetup{%
  rendererPrototypes = {
    inputFencedCode = {%
      \ifx\relax#2\relax
        \lstinputlisting{#1}%
      \else
        \lstinputlisting[language=#2]{#1}%
      \fi
    }
  },
  rendererPrototypes = {
    codeSpan = {\lstinline!#1!}%
  }
}

\begin{document}
\maketitle

\tableofcontents

\pagebreak

\section*{Abstract}

\section{Contexte}
% État de l'art, motivation du stage

\markdownInput{main.md}

\begin{appendices}
  \section{Preuves de typage}
\end{appendices}

\bibliographystyle{alpha}
\bibliography{references}
\end{document}
